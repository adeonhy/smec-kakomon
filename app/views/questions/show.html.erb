
<ul class="breadcrumb">
    <li><%= link_to 'Home', '/' %><span class="divider">/</span></li>
    <li><%= link_to "#{@year} 年度 #{@kamoku}", "/q/#{@question.subject}/#{@year}" %>
        <span class="divider">/</span></li>
    <li class="active"><%= "第#{@question.number}問" %></li>
</ul>

<h4><%= @year %>年度 <%= @kamoku %></h4>
<table class="table table-bordered">
    <!--
    <thead>
        <tr><th>qnum</th><th>sqnum</th><th>tcode</th><th>svg</th></tr>
    </thead>
    -->
    <tbody>
        <tr><td>
                <%= render partial: "shared/questions", object: @question %>
        </td></tr>
    </tbody>
</table>

<ul class="pager">
    <% p = @question.prev %>
    <% n = @question.next %>
    <li class="previous">
    <% if p %>
        <%= link_to("＜前の問題", "/q/#{p.subject}/#{p.year}/#{p.number}") %>
    <% else %>
        <%= link_to("#{@question.year}年#{@question.kamoku}", "/q/#{@question.subject}/#{@question.year}") %>
    <% end %>
    </li>
    <li class="next">
    <% if n %>
        <%= link_to("次の問題＞", "/q/#{n.subject}/#{n.year}/#{n.number}") %>
    <% else %>
        <%= link_to("#{@question.year}年#{@question.kamoku}", "/q/#{@question.subject}/#{@question.year}") %>
    <% end %>
    </li>
</ul>

<div class="tabbable tabs-top">
    <ul class="nav nav-tabs">
        <li class="active">
        <a href="#kanren" data-toggle="tab">関連情報(<%= @question.comments.count %>)</a></li>
        <li>
        <a href="#theme" data-toggle="tab">同じテーマの出題状況(<%= @themequestions.count %>)</a>
        </li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane active", id="kanren">
            <% if @question.comments.any? %>
                <ul>
                    <% @question.comments.each do |c| %>
                        <% if c.id %>
                            <li id="comment_<%= c.id %>">
                            <%= c.body %> by <%= c.commenter %>
                            <%= link_to content_tag('i', '', class: 'icon-trash'),
                                "/q/#{@question.subject}/#{@question.year}/#{@question.number}/c/#{c.id}",
                            confirm: "削除してもよろしいですか？", method: :delete, remote: true %>
                            </li>
                        <% end %>
                    <% end %>
                </ul>
            <% else %>
                <p>関連情報はありません。</p>
            <% end %>

            <%= form_for( @question.comments, url: "/q/#{@question.subject}/#{@question.year}/#{@question.number}/c", method: 'POST') do |f| %>
                <% if @comment.errors.any? %>
                    <ul>
                        <% @comment.errors.full_messages.each do |msg| %>
                            <li><%= msg %></li>
                        <% end %>
                    </ul>
                <% end %>
                <div class="field">
                    <%= f.label :commenter %>
                    <%= f.text_field :commenter %>
                </div>
                <div class="field">
                    <%= f.label :body %>
                    <%= f.text_area :body, rows: 5 %>
                </div>
                <div class="actions">
                    <%= f.submit %>
                </div>
            <% end %>
        </div>
        <div class="tab-pane", id="theme">
            <p><%= link_to "#{@theme.maintheme}/#{@theme.subtheme}", "/theme/#{@theme.themecode}" %></p>
            <table class="table table-bordered">
                <thead>
                    <tr><td>2012年</td><td>2011年</td><td>2010年</td><td>2009年</td><td>2008年</td></tr>
                </thead>
                <tbody>
                    <tr>
                        <% [2012, 2011, 2010, 2009, 2008].each do |year| %>
                            <td>
                                <% yearqestions = @themequestions.select{|x|x.year==year}.each do |q| %>
                                    <p><%= link_to "第#{q.number}問", "/q/#{q.subject}/#{q.year}/#{q.number}" %></p>
                                <% end %>
                                <%= "-" if yearqestions.empty? %>
                            </td>
                        <% end %>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>


<%= link_to 'Topへ', '/' %>

<script>
    $(function() {
        $('a[data-method="delete"]').live('ajax:success', function(e, data, status, xhr){
           // alert("deleted!");
           $('#comment_' + data.comment.id).fadeOut("slow");
        });
    });
</script>
